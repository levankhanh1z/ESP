-- Các biến cấu hình
local espParts = {"Stone"}  -- Danh sách tên các phần tử muốn hiển thị ESP
local espTransparency = 0.5  -- Độ trong suốt của hộp ESP

-- Các biến cho thông tin khoảng cách
local player = game.Players.LocalPlayer

-- Hàm kiểm tra xem một giá trị có tồn tại trong bảng hay không
function FindInTable(tbl, value)
    for _, v in ipairs(tbl) do
        if v == value then
            return true
        end
    end
    return false
end

-- Hàm tạo hiệu ứng ESP cho một phần tử
function CreateESP(part, distance)
    local espAdornment = Instance.new("BoxHandleAdornment")
    espAdornment.Name = part.Name:lower().."_PESP"
    espAdornment.Parent = part
    espAdornment.Adornee = part
    espAdornment.AlwaysOnTop = true
    espAdornment.ZIndex = 0
    espAdornment.Size = part.Size
    espAdornment.Transparency = espTransparency
    espAdornment.Color = BrickColor.new("Lime green").Color

    -- Tạo đối tượng TextLabel để hiển thị tên và khoảng cách
    local label = Instance.new("TextLabel")
    label.Parent = espAdornment
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextStrokeTransparency = 0.5
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextStrokeColor3 = Color3.new(0, 0, 0)
    label.Text = part.Name .. "\n" .. tostring(distance) .. "m"
end

-- Hàm kiểm tra và cập nhật ESP cho tất cả các phần tử con của game.Workspace.Mine
function UpdateESPForAllChildren()
    for _, child in pairs(game.Workspace.Mine:GetChildren()) do
        if child:IsA("BasePart") and FindInTable(espParts, child.Name:lower()) then
            local character = player.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                local playerPosition = character.HumanoidRootPart.Position
                local partPosition = child.Position
                local distance = (partPosition - playerPosition).magnitude
                CreateESP(child, distance)
            end
        end
    end
end

-- Lắng nghe sự kiện thêm phần tử mới trong game.Workspace.Mine
game.Workspace.Mine.DescendantAdded:Connect(function(descendant)
    if descendant:IsA("BasePart") then
        UpdateESPForAllChildren()
    end
end)

-- Lắng nghe sự kiện khi phần tử trong game.Workspace.Mine thay đổi
game.Workspace.Mine.DescendantRemoving:Connect(function(descendant)
    if descendant:IsA("BasePart") then
        -- Xóa ESP khi phần tử bị loại bỏ
        local espAdornment = descendant:FindFirstChild(descendant.Name:lower().."_PESP")
        if espAdornment then
            espAdornment:Destroy()
        end
    end
end)

-- Gọi hàm cập nhật ESP cho tất cả các phần tử con khi kịch bản bắt đầu
UpdateESPForAllChildren()
